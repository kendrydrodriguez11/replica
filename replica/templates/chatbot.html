{% extends 'base.html' %}
{% load static %}

{% block title %}Mental Health Chatbot{% endblock %}

{% block content %}
<div class="chatbot-container">
    <!-- Sidebar con chat -->
    <div class="chat-sidebar">
        <div style="padding: 15px 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); background: rgba(0, 0, 0, 0.2);">
            <a href="{% url 'replica:menu' %}" style="color: #90caf9; text-decoration: none; display: inline-flex; align-items: center; gap: 6px; font-size: 0.9rem;">
                ← Back to Menu
            </a>
        </div>
        <div class="chat-header">
            <h2>Mental Health<br>Chatbot</h2>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <!-- Mensaje inicial del usuario -->
            <div class="message user-message">
                <div class="message-label">You</div>
                <div class="message-content">hello</div>
            </div>
            
            <!-- Respuesta del bot -->
            <div class="message bot-message">
                <div class="message-label">Ashgen</div>
                <div class="message-content">
                    Hello, how can I assist you today?
                </div>
            </div>
            
            <!-- Segundo mensaje del usuario -->
            <div class="message user-message">
                <div class="message-label">You</div>
                <div class="message-content">depressed</div>
            </div>
            
            <!-- Segunda respuesta del bot -->
            <div class="message bot-message">
                <div class="message-label">Ashgen</div>
                <div class="message-content">
                    Stay hydrated, rest in a dark quiet room, and try a pain reliever like paracetamol. If it's recurring or severe, please see a doctor.
                </div>
            </div>
        </div>
        
        <div class="chat-input-container">
            <input 
                type="text" 
                id="chatInput"
                class="chat-input" 
                placeholder="Type a message..."
            >
            <button class="send-btn" onclick="sendMessage()">➤</button>
        </div>
    </div>
    
    <!-- Visualización derecha con imagen real -->
    <div class="chat-visual">
        <div class="brain-hand-container">
            <img src="https://images.unsplash.com/photo-1559757175-0eb30cd8c063?w=800&h=600&fit=crop" 
                 alt="Hand holding brain concept" 
                 class="brain-hand-image">
            
            <!-- Overlay con ilustración -->
            <div class="brain-overlay">
                <svg viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg" class="brain-svg">
                    <!-- Contorno de cabeza -->
                    <ellipse cx="200" cy="160" rx="80" ry="100" 
                             fill="none" stroke="white" stroke-width="3" opacity="0.8"/>
                    
                    <!-- Cerebro -->
                    <path d="M 140 120 Q 160 90, 200 95 Q 240 90, 260 120" 
                          fill="none" stroke="white" stroke-width="2.5" opacity="0.9"/>
                    <path d="M 145 140 Q 165 120, 200 122 Q 235 120, 255 140" 
                          fill="none" stroke="white" stroke-width="2.5" opacity="0.8"/>
                    <path d="M 150 160 Q 175 145, 200 147 Q 225 145, 250 160" 
                          fill="none" stroke="white" stroke-width="2.5" opacity="0.7"/>
                    
                    <!-- Chat bubble -->
                    <rect x="160" y="190" width="80" height="50" rx="15" 
                          fill="rgba(139, 69, 19, 0.7)" stroke="white" stroke-width="2"/>
                    <circle cx="180" cy="215" r="4" fill="white"/>
                    <circle cx="200" cy="215" r="4" fill="white"/>
                    <circle cx="220" cy="215" r="4" fill="white"/>
                    
                    <!-- Nodos de conexión -->
                    <circle cx="120" cy="100" r="5" fill="white" opacity="0.7"/>
                    <circle cx="280" cy="100" r="5" fill="white" opacity="0.7"/>
                    <circle cx="100" cy="140" r="5" fill="white" opacity="0.7"/>
                    <circle cx="300" cy="140" r="5" fill="white" opacity="0.7"/>
                    <circle cx="110" cy="180" r="5" fill="white" opacity="0.7"/>
                    <circle cx="290" cy="180" r="5" fill="white" opacity="0.7"/>
                    
                    <!-- Líneas de conexión -->
                    <line x1="120" y1="100" x2="160" y2="110" stroke="white" opacity="0.5" stroke-width="1.5"/>
                    <line x1="280" y1="100" x2="240" y2="110" stroke="white" opacity="0.5" stroke-width="1.5"/>
                    <line x1="100" y1="140" x2="150" y2="145" stroke="white" opacity="0.5" stroke-width="1.5"/>
                    <line x1="300" y1="140" x2="250" y2="145" stroke="white" opacity="0.5" stroke-width="1.5"/>
                </svg>
            </div>
            
            <!-- Estrellas/partículas -->
            <div class="particle" style="top: 15%; left: 20%; width: 3px; height: 3px;"></div>
            <div class="particle" style="top: 25%; right: 15%; width: 4px; height: 4px;"></div>
            <div class="particle" style="bottom: 40%; left: 10%; width: 2px; height: 2px;"></div>
            <div class="particle" style="top: 45%; right: 25%; width: 3px; height: 3px;"></div>
            <div class="particle" style="bottom: 25%; right: 35%; width: 4px; height: 4px;"></div>
        </div>
        
        <div class="activate-text">Activate Windows<br>Go to Settings to activate Windows.</div>
    </div>
</div>

<style>
.brain-hand-container {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.brain-hand-image {
    width: 80%;
    max-width: 600px;
    height: auto;
    object-fit: cover;
    border-radius: 20px;
    filter: brightness(0.8) contrast(1.1);
}

.brain-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 400px;
    height: 400px;
    pointer-events: none;
}

.brain-svg {
    width: 100%;
    height: 100%;
    filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.3));
}

.particle {
    position: absolute;
    background: white;
    border-radius: 50%;
    animation: twinkle 2s infinite alternate;
}

@keyframes twinkle {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 1; }
}

.activate-text {
    position: absolute;
    bottom: 20px;
    right: 20px;
    color: rgba(255, 255, 255, 0.3);
    font-size: 0.85rem;
    text-align: right;
    line-height: 1.4;
}
</style>

{% block extra_js %}
<script>
function sendMessage() {
    const input = document.getElementById('chatInput');
    const messagesContainer = document.getElementById('chatMessages');
    const message = input.value.trim();
    
    if (message === '') return;
    
    // Agregar mensaje del usuario
    const userMessage = document.createElement('div');
    userMessage.className = 'message user-message';
    userMessage.innerHTML = `
        <div class="message-label">You</div>
        <div class="message-content">${message}</div>
    `;
    messagesContainer.appendChild(userMessage);
    
    // Limpiar input
    input.value = '';
    
    // Scroll al final
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
    
    // Simular respuesta del bot después de 1 segundo
    setTimeout(() => {
        const botResponse = getBotResponse(message);
        const botMessage = document.createElement('div');
        botMessage.className = 'message bot-message';
        botMessage.innerHTML = `
            <div class="message-label">Ashgen</div>
            <div class="message-content">${botResponse}</div>
        `;
        messagesContainer.appendChild(botMessage);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }, 1000);
}

function getBotResponse(userMessage) {
    const lowerMessage = userMessage.toLowerCase();
    
    if (lowerMessage.includes('sad') || lowerMessage.includes('depressed') || lowerMessage.includes('depression')) {
        return "Stay hydrated, rest in a dark quiet room, and try a pain reliever like paracetamol. If it's recurring or severe, please see a doctor.";
    } else if (lowerMessage.includes('anxious') || lowerMessage.includes('anxiety') || lowerMessage.includes('worry')) {
        return "It's normal to feel anxious sometimes. Try deep breathing exercises, take a short walk, or talk to someone you trust. If anxiety persists, consider speaking with a mental health professional.";
    } else if (lowerMessage.includes('stress')) {
        return "Stress is common but manageable. Take breaks, practice mindfulness, exercise regularly, and ensure you're getting enough sleep. Would you like some specific stress-reduction techniques?";
    } else if (lowerMessage.includes('help')) {
        return "I'm here to support you. You can share how you're feeling, and I'll do my best to provide guidance. Remember, for serious concerns, please reach out to a mental health professional.";
    } else if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
        return "Hello, how can I assist you today?";
    } else {
        return "Thank you for sharing. Can you tell me more about how you're feeling? I'm here to listen and help.";
    }
}

// Permitir enviar con Enter
document.getElementById('chatInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        sendMessage();
    }
});
</script>
{% endblock %}
{% endblock %}